{
  "version": 3,
  "sources": ["../../../../src/server/impl/storage_impl.ts"],
  "sourcesContent": ["import {\n  FileMetadata,\n  StorageHttpWriter,\n  StorageId,\n  StorageReader,\n  StorageWriter,\n} from \"../storage.js\";\nimport { performAsyncSyscall, performJsSyscall } from \"./syscall.js\";\nimport { validateArg } from \"./validate.js\";\n\nexport function setupStorageReader(): StorageReader {\n  return {\n    getUrl: async (storageId: StorageId) => {\n      validateArg(storageId, 1, \"getUrl\", \"storageId\");\n      return await performAsyncSyscall(\"storageGetUrl\", { storageId });\n    },\n    getMetadata: async (storageId: StorageId): Promise<FileMetadata> => {\n      return await performAsyncSyscall(\"storageGetMetadata\", { storageId });\n    },\n  };\n}\n\nexport function setupStorageWriter(): StorageWriter {\n  const reader = setupStorageReader();\n  return {\n    generateUploadUrl: async () => {\n      return await performAsyncSyscall(\"storageGenerateUploadUrl\", {});\n    },\n    delete: async (storageId: StorageId) => {\n      await performAsyncSyscall(\"storageDelete\", { storageId });\n    },\n    getUrl: reader.getUrl,\n    getMetadata: reader.getMetadata,\n  };\n}\n\nexport function setupStorageHttpWriter(): StorageHttpWriter {\n  const writer = setupStorageWriter();\n  return {\n    ...writer,\n    store: async (request: Request) => {\n      return await performJsSyscall(\"storage/storeFile\", {\n        request,\n      });\n    },\n    get: async (storageId: StorageId) => {\n      return await performJsSyscall(\"storage/getFile\", {\n        storageId,\n      });\n    },\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA,qBAAsD;AACtD,sBAA4B;AAErB,SAAS,qBAAoC;AAClD,SAAO;AAAA,IACL,QAAQ,OAAO,cAAyB;AACtC,uCAAY,WAAW,GAAG,UAAU,WAAW;AAC/C,aAAO,UAAM,oCAAoB,iBAAiB,EAAE,UAAU,CAAC;AAAA,IACjE;AAAA,IACA,aAAa,OAAO,cAAgD;AAClE,aAAO,UAAM,oCAAoB,sBAAsB,EAAE,UAAU,CAAC;AAAA,IACtE;AAAA,EACF;AACF;AAEO,SAAS,qBAAoC;AAClD,QAAM,SAAS,mBAAmB;AAClC,SAAO;AAAA,IACL,mBAAmB,YAAY;AAC7B,aAAO,UAAM,oCAAoB,4BAA4B,CAAC,CAAC;AAAA,IACjE;AAAA,IACA,QAAQ,OAAO,cAAyB;AACtC,gBAAM,oCAAoB,iBAAiB,EAAE,UAAU,CAAC;AAAA,IAC1D;AAAA,IACA,QAAQ,OAAO;AAAA,IACf,aAAa,OAAO;AAAA,EACtB;AACF;AAEO,SAAS,yBAA4C;AAC1D,QAAM,SAAS,mBAAmB;AAClC,SAAO;AAAA,IACL,GAAG;AAAA,IACH,OAAO,OAAO,YAAqB;AACjC,aAAO,UAAM,iCAAiB,qBAAqB;AAAA,QACjD;AAAA,MACF,CAAC;AAAA,IACH;AAAA,IACA,KAAK,OAAO,cAAyB;AACnC,aAAO,UAAM,iCAAiB,mBAAmB;AAAA,QAC/C;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
